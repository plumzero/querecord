
### 数据库连接

MongoDB 数据库连接的标准 URI 语法如下:
```sh
    mongodb://[username:password@]host1[:port1][,host2[:port2],...[/[database]][?options]]
```
例如本地连接:
```sh
    mongodb://localhost
```
连接三台:
```sh
    mongodb://localhost,localhost:27018,localhost:27019
```

### 创建和删除数据库

```sh
    > use DATABASE_NAME
```
如果数据库不存在，则创建数据库，否则切换到指定数据库。

```sh
    db.dropDatabase()
```

### 集合操作

创建集合。MongoDB 中用 `createCollection()` 方法来创建集合，语法格式如下:
```sh
    db.createCollection(name, options)
```
示例:
```sh
    > db.createCollection("my_collection")
    { "ok" : 1 }
```

删除集合。MongoDB 中用 `drop()` 方法来删除集合，语法格式如下:
```sh
    db.collection.drop()
```
示例:
```sh
    > db.my_collection().drop()
    true
```

### 文档操作

插入文档。使用 `insert()` 方法向集合中插入文档，语法如下:
```sh
    db.collection.insert(document)
```
也可以使用 `save()` 方法:
```sh
    db.collection.save(document)
```
示例:
```sh
    > db.my_collection.insertOne(
        {
            "name": "shirdon",
            "address": "chengdu"
        }
    )
```

查询文档。语法格式如下:
```sh
    db.collection.find(query, projection)
```
查询所有文档示例:
```sh
    > db.my_collection.find({})
```
按条件查询语法格式:
```sh
    db.collection.find({"字段1":"值1","字段2":"值2"})
```
条件查询示例:
```sh
    > db.my_collection.find({"name":"shirdon", "address":"chengdu"})
```
按范围查询文档格式如下:
```sh
    db.collection.find(
        {
            "字段1":{"修饰符1":边界1, "修饰符2":边界2},
            "字段2":{"修饰符1":边界1, "修饰符2":边界2}
        }
    )
```
常见范围修饰符及其意义如下:

| 修饰符 | 意义 |
|:-------|:----|
| `$gt` | 大于 |
| `$gte` | 大于或等于 |
| `$lt` | 小于 |
| `$lte` | 小于或等于 |
| `$ne` | 不等于 |

示例代码如下:
```sh
    > db.my_collection.find(
        {
            "name" : { "$ne":"shirdon" }
        }
    )
```

通过 `count()` 统计文档的个数:
```sh
    > db.my_collection.find({}).count()
```

通过 `limit()` 限定返回结果数量:
```sh
    > db.my_collection.find({}).limit(1)
```

通过 `sort()` 方法对结果进行排序:
```sh
    > db.my_collection.find({}).sort({"name":1})
```
其中，-1 为逆序，1 为正序。

### 修改文档

`update()` 方法用于更新已存在的文档。语法格式如下:
```sh
    db.collection.update(
        <query>,
        <update>,
        {
            upsert: <boolean>,
            multi: <boolean>,
            writeConcern: <document>
        }
    )
```
示例如下:
```sh
    > db.my_collection.update({'name':'barry'},{$set:{'address':'shanghai'}})
```

`save()` 方法通过传入的文档来替换已有文档，_id 主键存在就更新，不存在就插入。语法格式如下:
```sh
    db.collection.save(
        <document>,
        {
            writeConcern: <document>
        }
    )
```
示例如下:
```sh
    db.my_collection.save({
        "_id": ObjectId("61b1d4b02a0657eec8a7e657"),
        "name": "jack",
        "address": "chongqing"
    })
```

### 删除文档

`remove()` 方法来移除集合中的文档。基本语法格式如下:
```sh
    db.collection.remove(
        <query>,
        {
            justOne: <boolean>,
            writeConcern: <document>
        }
    )
```
示例如下:
```sh
    > db.my_collection.remove({'name':'jack'})
```

### 文档去重

进行文档去重使用 `distinct()` 方法。该方法将获取集合中指定字段的不重复值，并以数组的形式返回，其语法如下:
```sh
    db.collection.distinct(field, query, options)
```
它可以接收两个参数: 第 1 个参数为需要被去重的字段名，第 2 个参数是进行去重的条件(去重条件也就是进行查询操作的第 1 个参数，可以省略)。

去重示例:
```sh
    > db.my_collection.distinct("name", {"address":{"$ne":"shanghai"}})
```
这个的含义就是，在 address 不等于 "shanghai" 的条件下对 name 字段进行去重。它的返回值是一个数组，这里就是去重后的表中 name 字段的非重复的数据。

注意: 这个去重是对返回值去重，而不是对数据库中的数据去重，即执行这个操作后数据库中的数据没有发生任何改变。

