
### mongo

MongoDB 的命令行 shell 为 mongo，将其置于可搜索命令路径下，缺省时会连接到 localhost:27017 上，也可以指定端口:
```sh
    mongo --port 28015
```

也可以像下面这样连接到远程主机:
```sh
    mongo "mongodb://mongodb0.example.com:28015"
    mongo --host mongodb0.example.com:28015
    mongo --host mongodb0.example.com --port 28015
```

认证连接时，需要指定用户名称，认证库，以及可选的密码(不在命令行提供时，会在连接时提示输入)，例如以 alice 用户进行远程连接:
```sh
    mongo "mongodb://alice@mongodb0.example.com:28015/?authSource=admin"
```
也可以像下面这样进行认证连接:
```sh
    mongo --username alice --password --authenticationDatabase admin --host mongodb0.example.com --port 28015
```

### 数据库操作

`db` 表示当前所处数据库:
```sh
    db
```

`use <db>` 用来切换数据库:
```sh
    use test
```
使用者在切换之前不必创建对应的数据库，MongoDB 在第一次存入数据时会创建该库，这也包括创建第一个 collection 。

列出当前用户下的所有可用数据库:
```sh
    show dbs
```

获取所在数据库的状态:
```sh
    db.stats()
```

获取其他数据库的状态:
```sh
    db.getSiblingDB("admin").stats()
```

获取所在数据库的名称:
```sh
    db.getName()
```

查看当前数据库的链接机器地址:
```sh
    db.getMongo()
```

修复所在数据库:
```sh
    db.repairDatabase()
```
在 MongoDB 中频繁的进行数据增删改时，如果记录变了，例如数据大小发生了变化，这时候容易产生一些数据碎片，出现碎片引发的结果，一个是索引会出现性能问题，另外一个就是在一定的时间后，所占空间会莫明其妙地增大，所以要定期把数据库做修复，定期重新做索引，这样会提升 MongoDB 的稳定性和效率。

删除所在数据库
```sh
    db.dropDatabase()
```

### 集合操作

列出当前库下的所有集合:
```sh
    show collections
```

创建集合(指定数据库大小size，最大存放100个文档，满了，MongoDB 就会删除旧文档):
```sh
    db.createCollection("human", {"size":1024, capped:true, max:100})
    db.createCollection("people")
```

查看指定集合的状态:
```sh
    db.people.stats()
```

获取指定集合:
```sh
    db.getCollection("human")
```
这个在有些情况下很有用，比如当集合以数字命名时，`db.xxx.drop()` 命令就会出错，可以使用如下命令解决:
```sh
    db.getCollection("20211217").drop()
```

以数组形式获取当前 db 中所有集合:
```sh
    db.getCollectionNames()
```

### 用户操作

列出可选角色:
```sh
    show roles
```

列出当前库下的所有用户:
```sh
    show users
```

为当前库添加一个用户:
```sh
    db.createUser({user:"zs",pwd:"111",roles:["read"]})
```

验证数据库是否通过认证:
```sh
    db.auth("zs", "111")
```
使用者通过命令行指定 zs 用户连接到 MongoDB 后，只能对符合认证的数据库进行操作。

删除用户:
```sh
    db.dropUser("zs")
```
