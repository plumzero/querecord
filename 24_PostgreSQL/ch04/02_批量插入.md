
批量插入是指一次性插入多条数据，主要用于提升数据插入效率。

PostgreSQL 有多种方法实现批量插入。

### INSERT INTO...SELECT...

通过表数据或函数批量插入，语法如下:
```sql
    INSERT INTO table_name SELECT...FROM source_table
```

比如创建一张表结构和 user_ini 相同的表并插入 user_ini 表的全量数据，代码如下:
```sql
    testdb => CREATE TABLE tbl_batch1(user_id bigint, user_name text);
    CREATE TABLE
    testdb => INSERT INTO tbl_batch1(user_id, user_name)
                SELECT user_id, user_name FROM user_ini;
    INSERT 0 1000000
```

通过函数进行批量插入:
```sql
    testdb => CREATE TABLE tbl_batch2(id int4, info text)
    CREATE TABLE
    testdb => INSERT INTO tbl_batch2(id, info)
                SELECT generate_series(1,5), 'batch2';
    INSERT 0 5
```

### INSERT INTO VALUES(),(),...()

```sql
    testdb => CREATE TABLE tbl_batch3(id int4, info text);
    CREATE TABLE
    testdb => INSERT INTO tbl_batch3(id,info) VALUES(1,'a'),(2,'b'),(3,'c');
    INSERT 0 3
```
这种批量插入方式，一条 SQL 插入多行数据，相比一条 SQL 插入一条数据的方式能减少和数据库的交互，减少数据库 WAL 日志的生成，提升插入效率。

### COPY 或 \COPY 元命令

`COPY` 或 `\copy` 元命令能够将一定格式的文件数据导入到数据库中，相比 INSERT 命令插入效率更高，通常大数据量的文件导入一般在数据库服务端主机通过 PostgreSQL 超级用户使用 COPY 命令导入。

```sql
    testdb => CREATE TABLE tbl_batch4 (
                id int4,
                info text,
                create_time timestamp(6) with time zone default clock_timestamp());
    CREATE TABLE
    
    testdb => INSERT INTO tbl_batch4(id,info) SELECT n, n||'_batch4'
                FROM generate_series(1,10000000) n;
    INSERT 0 10000000
```

使用 postgres 用户进行拷贝:
```sql
    testdb =# COPY tbl_batch4 TO '/home/postgres/tbl_batch4.txt';
    COPY 10000000
```

清空 tbl_batch4 表后再从文件导入:
```sql
    testdb =# TRUNCATE TABLE tbl_batch4;
    TRUNCATE TaBLE
    testdb =# COPY tbl_batch4 FROM '/home/postgres/tbl_batch4.txt';
    COPY 10000000
```
