
`.animate()` 方法在为一组特定的元素创建并发效果时非常有用。然而，有的时候我们需要的则是排队效果，即让效果一个接一个地发生。

### 处理一组元素

当为同一组元素应用多重效果时，可以通过连缀这些效果轻易地实现`排队`。

比如，相继执行移动 Text Size 盒子、增加其高度、加宽其边框:
```js
    $(document).ready(function() {
        $('div.label').click(function() {
            var paraWidth = $('div.speech p').outerWidth();
            var $switcher = $(this).parent();
            var switcherWidth = $switcher.outerWidth();
            $switcher
                .css({ position: 'relative' })
                .animate({left: paraWidth - switcherWidth}, 'slow')
                .animate({height: '+=20px'}, 'slow')
                .animate({borderWidth: '5px'}, 'slow');
        });
    });
```

排队效果并不仅限于 `.animate()` 方法，比如按照下列顺序对 `<div id='switcher'>` 盒子上的效果进行排队:
1. 通过 `.fadeTo()` 将其不透明度减退为 0.5
2. 通过 `.animate()` 将其移动到右侧
3. 通过 `.fadeTo()` 将其渐增回完全透明
4. 通过 `.slideUp()` 隐藏它
5. 通过 `.slideDown()` 再将其显示出来

```js
    $(document).ready(function() {
        $('div.label').click(function() {
            var paraWidth = $('div.speech p').outerWidth();
            var $switcher = $(this).parent();
            var switcherWidth = $switcher.outerWidth();
            $switcher
                .css({position: 'relative'})
                .fadeTo('fast', 0.5)
                .animate({left: paraWidth - switcherWidth}, 'slow')
                .fadeTo('slow', 1.0)
                .slideUp('slow')
                .slideDown('slow');
        });
    });
```

如果想让上面的第 1 个与第 2 个效果同时执行，该怎么办呢? 如果两个效果同速，可以将它们添加到同一个 `.animate()` 方法中执行，但这里不是。解决办法是让 2 `越过队列`执行:
```js
    $(document).ready(function() {
        $('div.label').click(function() {
            var paraWidth = $('div.speech p').outerWidth();
            var $switcher = $(this).parent();
            var switcherWidth = $switcher.outerWidth();
            $switcher
                .css({position: 'relative'})
                .fadeTo('fast', 0.5)
                .animate({
                    left: paraWidth - switcherWidth
                }, {
                    duration: 'slow',
                    queue: false
                })
                .fadeTo('slow', 1.0)
                .slideUp('slow')
                .slideDown('slow');
        });
    });
```
第二个参数(即选项对象)包含了 `queue` 选项，把该选项设置为 `false` 即可让当前动画与前一个动画同时开始。

有关为一组元素应用排队效果的最后一个需要注意的问题，就是排队不能自动应用到其他的非效果方法，如 `.css()`。比如在上面的效果 4 和 5 之间增加一个修改背景色的效果:
```js
    $(document).ready(function() {
        $('div.label').click(function() {
            var paraWidth = $('div.speech p').outerWidth();
            var $switcher = $(this).parent();
            var switcherWidth = $switcher.outerWidth();
            $switcher
                .css({position: 'relative'})
                .fadeTo('fast', 0.5)
                .animate({
                    left: paraWidth - switcherWidth
                }, {
                    duration: 'slow',
                    queue: false
                })
                .fadeTo('slow', 1.0)
                .slideUp('slow')
                .css({backgroundColor: '#f00'})
                .slideDown('slow');
        });
    });
```
然而，即使把修改背景颜色的代码放在连缀序列中正确的位置上，它也会在单击后立即执行。

把非效果方法添加到队列中的一种方式，就是使用 `.queue()` 方法:
```js
    $(document).ready(function() {
        $('div.label').click(function() {
            var paraWidth = $('div.speech p').outerWidth();
            var $switcher = $(this).parent();
            var switcherWidth = $switcher.outerWidth();
            $switcher
                .css({position: 'relative'})
                .fadeTo('fast', 0.5)
                .animate({
                    left: paraWidth - switcherWidth
                }, {
                    duration: 'slow',
                    queue: false
                })
                .fadeTo('slow', 1.0)
                .slideUp('slow')
                .queue(function(next) {
                    $switcher.css({backgroundColor: '#f00'});
                    next();
                })
                .slideDown('slow');
        });
    });
```
`.queue()` 方法将参数回调函数添加到相应元素的效果队列中，函数内部最后又调用了 `next()` 方法，其返回的结果将作为参数传给回调函数。添加的这个 next() 方法可以让队列在中断的地方再接续起来，然后再与后续的 `.slideDown('slow')` 连缀在一起。如果在此不使用 next() 方法，动画就会中断。

### 处理多组元素

与一组元素的情况不同，当为不同组的元素应用效果时，这些效果几乎会同时发生。

为第 3 段添加 click 程序，单击它时会将第 3 段向上滑(最终滑出视图)，同时将第 4 段向下滑(最终滑入视图):
```js
    $(document).ready(function() {
        $('p').eq(2)
            .css('border', '1px solid #333')
            .click(function() {
                // $(this).next() 之后，$(this) 引用的元素，就是第四个段落了
                $(this).slideUp('slow').next().slideDown('slow');
            });
        $('p').eq(3).css('backgroundColor', '#ccc').hide();
    });
```

为了对不同元素上的效果实现排队，jQuery 为每个效果方法都提供了`回调函数`。回调函数就是作为方法的参数传递的一个普通函数，在效果方法中，它们是方法的最后一个参数。

当使用回调函数排队两个滑动效果时，可以在第 3 个段落滑上之前，先将第 4 个段落滑下:
```js
    $(document).ready(function() {
        $('p').eq(2)
            .css('border', '1px solid #333')
            .click(function() {
                // $(this).next() 执行之后，$(this) 引用的元素，就是第四个段落了，它执行 .slideDown 和 .slideUp
                $(this).next().slideDown('slow', function() {
                    $(this).slideUp('slow');
                });
            });
        $('p').eq(3).css('backgroundColor', '#ccc').hide();
    });
```

初学者的噩梦! 可选地引用 `$(this)` 的一种简单方法，就是在 `.click()` 方法内部把它保存到一个变量中，比如 `var $clickedItem = $(this)`。

这样，无论是在回调函数的外部还是内部， `$clickedItem` 引用的都是第三个段落了:
```js
    $(document).ready(function() {
        $('p').eq(2)
            .css('border', '1px solid #333')
            .click(function() {
                var $clickedItem = $(this);
                $clickedItem.next().slideDown('slow', function() {
                    $clickedItem.slideUp('slow');
                });
            });
        $('p').eq(3).css('backgroundColor', '#ccc').hide();
    });
```