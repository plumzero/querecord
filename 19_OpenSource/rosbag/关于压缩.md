
调用 `setCompression` 设置压缩方式后，编译可以通过，但在运行时报错如下:
```c
my-program: /path/to/boost/include/boost/smart_ptr/shared_ptr.hpp:734: typename boost::detail::sp_member_access<T>::type boost::shared_ptr<T>::operator->() const [with T = rosbag::Stream; typename boost::detail::sp_member_access<T>::type = rosbag::Stream*]: Assertion `px != 0' failed.
Aborted
```

看了一下对应位置的源码，是这样的:
```c
732    typename boost::detail::sp_member_access< T >::type operator-> () const BOOST_SP_NOEXCEPT_WITH_ASSERT
733    {
734        BOOST_ASSERT( px != 0 );
735        return px;
736    }
```
没有为指针赋值。

智能指针模板参数为 Stream，找到如下代码:
```c
shared_ptr<Stream> StreamFactory::getStream(CompressionType type) const {
  switch (type) {
    case compression::Uncompressed:
      return uncompressed_stream_;
#ifdef _BZIP2
    case compression::BZ2:
      return bz2_stream_;
#endif
#ifdef _LZ4
    case compression::LZ4:
      return lz4_stream_;
#endif
    default:
      return shared_ptr<Stream>();
  }
}
```
原来是没有定义 _BZIP2 或 _LZ4 导致。

通过 cmake 将宏打开，之后根据编译报错提示引入相应的 bzip2 源文件，解决。
