
### 持续构建与部署

发布事项
- 将所有的代码和配置文件都存放到版本控制系统中
- 为每个发布版本创建一个新的发布分支

进行持续构建与部署时，明确发布的策略和流程，并通过多层安全和访问机制来确保在发布过程中只有指定的人才能执行指定的流程操作。

这其中要关注以下几种流程操作:
- 批准源代码改动
- 指定发布流程中需要执行的具体动作
- 创建新的发布版本
- 批准初始的集成请求(也就是一个以某个源代码仓库版本为基础的构建请求)，以及后续的 cherry picking 请求
- 实际部署某个发布版本
- 修改某个项目的构建配置文件

1. 构建

对构建环境进行配置性检查，内容包括内核版本、编译器版本、环境变量等...

通过项目管理工具(如 CMake/Make 等)对文件(源文件、依赖库、测试文件、模板等)进行组织管理和处理依赖关系，定义构建目标(可执行程序、库文件、配置、脚本等)，输出结果。

2. 分支

- 开发期: 迅速迭代时期

设置两种分支，一个是主分支，还有一种是各开发人员的独立分支。在这个时间开发人员围绕主分支进行提交/合并/拉取。

- 维护期: 上线之后的稳定期

清除开发期时设置的独立分支，保留主分支，同时另外设置两种分支。一种是需求分支，基于主分支创建，用于提交对需求/功能/bug等的修改。一种是发布分支，基于主分支创建，使用版本号方式命名，不作任何修改，用作发布。

3. 测试

持续测试会在每个主分支改动提交之后运行单元测试，以便快速检测构建错误和测试错误。建议使用项目中定义的构建目标及测试目标的执行结果来决定是否发布某个版本(即创建发布分支)，使用最后一个测试全部通过的软件版本来进行最新的发布。

在发布过程中，也会使用该发布分支重新运行全部单元测试，同时为测试结果创建审核记录。

无论发布成功或失败，都可以将版本号、COMMIT ID(作为构建 ffID)、文件名及对应哈希值，以及最后的发布状态(成功或失败)记入数据库以便查看。

4. 部署

软件(可执行文件、依赖库、配置、脚本等)可以通过 tar 方式进行打包，之后将其分发到生产机器上完成部署。

在打包时同时要将一些信息，如版本号、COMMIT ID、文件名及对应哈希值等进行打包。


### 配置管理

- 静态配置文件可以与二进制文件一起打包。
- 动态配置文件可以保存在外部存储服务中。
