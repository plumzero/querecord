
### 数据完整性与系统可用性

数据完整性指的是其生命周期中，数据的准确性和一致性。

数据完整性是手段，数据可用性是目标。



### 备份与存档

存档: 将数据长时间安全保存，以满足审核、取证和合规要求。

备份用来预防数据丢失和及时恢复。
- 完整备份
- 增量备份
- 流式持续备份

当选择备份策略时，一定要考虑针对某个问题需要的恢复时间，以及可以丢失多少最新数据。


### 备份和相关的恢复方法

备份不重要，最重要的是恢复。对"恢复"提供支持，应该是主导备份系统设计的关键。

由此可见，在设计备份还原系统时，必须考虑:
- 使用哪种备份和还原方法
- 通过全量或增量备份建立恢复点(restore point)的频率
- 备份的存储位置
- 备份的保留时间

另外一个关键问题是：在一次数据恢复中能够损失多少最近数据，能够损失的数据越少，增量备份策略就越重要。

频繁地进行全量备份是非常昂贵的，这也会给线上存储带来巨大压力。为了缓解这种压力，我们需要在非峰值时间段进行全量备份，同时在繁忙时间段进行增量备份。

在此之外，故障恢复的时间很重要。所需的故障恢复时间越短，备份存放的位置越需要本地化。

备份应该保存多久呢？备份策略随着保存时间的增长，成本会上升，但是同时可恢复的时间也会提高。Google 将大部分服务的备份周期定于 30~90 天之间。每个服务必须通过针对数据丢失的容忍度设计和早期预警系统的研发投入来保障落入这个区间。

以合理成本满足一系列广泛的数据恢复场景都需要分级备份。第一级备份是那些备份频率很高，并且可以快速恢复的备份。这些备份保存在与线上数据存储距离最近的地方，使用与数据存储相同或者是非常相似的存储技术。这样可以为大部分的软件 Bug，以及开发者错误的场景提供保护。由于成本相对较高，备份在这一层会保留数小时，最多 10 天之内，恢复时间在几分钟内。

第二级备份的频率较低，只保留一位数或者两位数字的天数。第二级备份保存在当前部署点的随机读写分布式文件系统上。这些备份可能需要数个小时来备份，是用来为服务所使用的数据存储出现的相关问题提供额外保护的。这一级别的备份也可以用来针对那些检测时间太晚的应用程序 Bug，以至于无法使用上一级别的备份恢复的问题。

接下来的级别会使用冷存储，包括固定的磁带库以及异地备份存储设施。这些级别的备份可以保护单个部署点级别的故障，例如数据中心电源故障等。

关于海量数据备份: 处理海量数据，最重要也最有效的方式是给数据建立一个"可信点"——也就是一部分数据校验过之后，由于时间等原因变成不可变数据了。接下来，我们可以进行增量备份，其中仅仅包含自从上次("可信点")备份后新增或者更改过的数据。这种技术可以将备份时间缩减到与主要处理逻辑的吞吐量在一个数量级内。



