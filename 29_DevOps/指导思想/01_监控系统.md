
监控处于整个生产环境需求金字塔模型的最底层，是运营一个可靠的稳定服务不可缺少的部分。

一个大型系统不应该要求运维人员持续关注其中使用的无数个小组件，而是应该自动汇总所有的信息，自动抛弃其中的异常情况。监控系统应该主要从高级服务质量目标层面进行报警，但是也应该保持足够的粒度，可以追踪到某个具体组件。

> 如何将内部变量暴露给监控系统? Google 是这样做的。
> Google 内部产生的每个二进制文件中都默认包含一个 HTTP 服务，同时每种主流编程语言都提供了一个编程接口可以自动注册暴露指定的程序变量。软件服务器作者可以随后对这个变量进行简单地增加操作，或者直接修改这个变量的值。Go 语言中的 expvar 标准库和它的 JSON 输出格式也提供了类似的 API 。

### 监控分级

一个监控系统应该只有三类输出:
- 紧急警报: 需要立即执行处理，如严重情况的报警。
- 工单: 将重要但不紧急的报警发送给工单系统。
- 日志: 不时之需，用来作为历史数据或者服务监控台(dashboard)展示使用。

为了避免运维压力过大，理想情况下，运维压力过载应该是基于数据且可以量化的。这样我们的目标也就可以量化(例如: 每天工单数量 < 5，每次轮值报警事件 < 2 等)。

### 监控指标

监控系统的 4 个黄金指标。如果我们只能监控用户可见系统的指标，那么就应该监控这 4 个:
- 延迟: 服务处理某个请求所需要的时间。这里要区分成功请求和失败请求。
- 流量: 使用系统中的某个高层次的指标针对系统负载需求所进行的度量。对 Web 服务器来说，该指标通常是每秒 HTTP 请求数量，同时可能按请求类型分类(静态请求与动态请求)。
- 错误: 请求失败的速率，要么是显式失败(例如错误码返回)，要么是隐式失败(例如返回内容不合要求)，或者策略原因导致的失败(例如未在规定时间内返回)。不同的错误，其监控方式也不一样: 在负载均衡器上检测 HTTP 500 请求可能足够抓住所有的完全失败的请求，但是只有端到端的系统才能检测到返回错误内容这种故障类型。
- 饱和度: 服务容量有多"满"。通常是系统中目前最为受限的某种资源的某个具体指标的度量。(在内存受限的系统中，即为内存；在I/O受限的系统中，即为I/O)。这里要注意，很多系统在达到 100% 利用率之前性能会严重下降，所以增加一个利用率目标也是很重要的。

### 监控指标的收集方式

利用配置文件配置需要收集的目标列表，目标位置可以使用各种地址解析服务支持的格式。这个目标列表可以(也通常)是动态变化的，所以一套服务发现体系可以降低监控系统的配置维护难度，允许监控系统自动扩展。

监控系统按照配置规定的周期，定时抓取 URI 资源，得到信息解码，存储在内存中。