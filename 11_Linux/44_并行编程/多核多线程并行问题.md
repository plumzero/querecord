
多核处理器上的所有核心共享内存，但可以有各自的一、二级缓存和寄存器。

由于资源共享，在多核处理器上使用线程级并行需要注意的问题有以下几个:


### 线程过多

如果系统上的线程数量远远超过核心的数量，那么就会导致频繁的上下文切换，进而降低性能，如缓存污染。

通常支持超线程的多核处理器能够使用的线程数最多是物理核心数的 2 倍(即逻辑核心数)，再增加就有可能降低程序的性能。

```
    超线程概念:
    Intel 的一些高端机器支持称为"超线程"(Hyper-Threading, HT)的技术，其实现是将一个物理核模拟成两个逻辑核，可并行执行两个线程，让单核也能够达到线程级并行计算，减少了 CPU 的闲置时间，提高了 CPU 的运行效率。
    超线程技术需要主板芯片组和操作系统的配合，才能充分发挥其效能。
```


### 数据竞争

当多个线程读写同一共享数据时，便会产生竞争。比如两个线程对同一个共享数据执行操作时，就需要同步以保证结果的一致性。

同步会导致线程之间的互相等待，从而降低了性能。


### 死锁

线程发生死锁时，处理器会一直询问需要的资源是否可用。但是线程都在相互等待其他线程释放资源，谁也无法前进一步，处理一种"僵死"的状态。


### 饿死

当一个或多个线程永远没有机会调度到处理器上执行，就会陷入到漫长的等待状态。


### 伪共享

当多个线程读写的数据映射到同一条缓存线上时(如三级缓存)，如果一个线程更改了数据，那么其他线程对该数据的缓存就会失效。如果线程频繁地更改数据，硬件就需要不停地更新缓存线，这使性能从独享缓存的水平降低到共享缓存或内存的水平。