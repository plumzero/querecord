

### 缓存层次

为了更好地利用程序访问内存/缓存的局部性，现代处理器采用了多层次的、容量不同和性能不同的缓存，其中上一级缓存容量比下一级缓存小，但是延迟更小、带宽更大。

比如 Intel Haswell CPU 一级缓存大小为 32KB，延迟为 3 个周期，读吞吐量为每周期 64 bytes。其二级缓存大小为 256KB，延迟为 11 个周期，读吞吐量为每周期 64 字节。

现代处理器至少具有二级缓存，某些高端多核处理器还具有三级缓存。

各级缓存采用类似金字塔式的层级存储结构，寄存器缓存一级缓存，一级缓存缓存二级缓存，二级缓存缓存三级缓存，三级缓存RAM，RAM 缓存硬盘、网络等，而硬盘缓存远程请求等。

由于这种金字塔的保存方式，某些数据可能同时被缓存在某个核心的多个缓存层次上(也有可能只缓存在某个层次上)。在多核处理器上，某个数据还可能同时被多个核心上的缓存所缓存(这会产生伪共享问题)。


### 缓存命中率

一次内存访问，如果访问的数据在缓存中，则称为缓存命中，如果不在，则称为缓存不命中。缓存命中率就是指程序执行过程中缓存命中的次数占总访存次数的百分比。

通常，程序的缓存优化过程就是提高缓存命中率的过程。


### 缓存一致性问题

某个进程读入一个磁盘文件，并在进程中对该文件进行修改。如果此时修改结果没有同步到磁盘文件，而其他进程又去读这个磁盘文件的话，就会产生文件不一致的情况。

同样地，多核处理器中，某个核心对缓存数据的修改如果无法及时同步到内存，而其他核心又要读取内存中的这个数据时，就会产生缓存一致性问题。

为了读取数据的正确性，一旦一个核心更改了某个地址的数据，其他的核心就需要对缓存的该地址数据失效。这通过硬件来实现，可以理解的是，其处理代价肯定与处理器的数目成正相关。

