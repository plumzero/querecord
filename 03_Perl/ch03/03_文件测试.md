
### 为什么要进行文件测试

有些时候，你可能需要先检查一下同名文件是否存在...

有些时候，你可能需要看看给定的文件究竟存在多久...

有些时候，你可能需要比较一些文件的大小...

有些时候，你可能要看文件是否在某个级别以上或者已经有一段时间无人使用...

对于这些，Perl 提供了一组用于测试文件的操作符，借此返回特定的文件信息。


### 文件测试操作符

常用的文件测试操作符

| 名称 | 说明 |
|:----:|:----:|
| -e   | 文件是否存在 |
| -f   | 是否为普通文件 |
| -d   | 是否为目录 |
| -l   | 是否为符号链接 |
| -z   | 文件存在且没有内容(对目录永远为假) |
| -r   | 文件或目录是否可读 |
| -w   | 文件或目录是否可写 |
| -x   | 文件或目录是否可执行 |


绝大多数测试操作符返回布尔真假值，但也有例外。

| 名称 | 说明 |
|:----:|:----:|
| -M   | 返回文件最后一次修改后至今的天数 |
| -A   | 返回文件最后一次访问后至今的天数 |
| -C   | 返回文件最后一次节点编号(inode)被变更后至今的天数 |
| -s   | 文件或目录存在且有内容(返回值是以字节为单位的文件大小) |


> 关于文件测试操作符的写法

你可以像下面这样写:
```pl
  if (! -e $filename) {
    print "$filename not exist\n";
  }
```
但这种写法并非太好。

对于文件的测试工作应该看作是业务中的一个附加操作。为了不影响主业务流程阅读，一般使用下面的写法:
```pl
  die "$filename not exist\n"
    if ! -e $filename;
```

[示例程序](t/03_filetest_eMs.pl)


### 测试同一文件的多项属性

```pl
  if (-r $file and -w _) {
    ...
  }
```
`_` 是一个虚拟文件句柄，它可以避免重复的读取一个文件。


> 栈式的写法

```pl
  use 5.010;
  
  if (-w -r $file) {
    print "The file is both readable and writable!\n";
  }
  
  if (-r -w -x -o -d $file) {
    print "My directory is readable, writable, and executable!\n";
  }
```
使用栈式写法时，靠近文件名的测试会先执行，次序为从右往左，但通常测试次序不是很重要。

注意，对于返回真假值以外的测试来说，栈式写法并不出色:
```pl
  if (-s -d $file < 512) {    # 错误
    say 'The directory is less than 512 bytes!';
  }
```


### stat 和 lstat 函数

前面提到的文件描述符只能获取文件部分信息，如果想要获取更多的信息，可以使用这两个函数。

其用法类似 Linux/Unix Posix 同名函数。

